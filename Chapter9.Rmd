---
title: "Final Project"
author: "Group 1:Boyeon Kim, Donguk Yoom, JungYoon Choi, Semin Seo, Hanseung Jang, Sanghyun Lee, Helena Burke, Seokyeong Park, Dahye Chung"
date: "`r Sys.Date()`"
documentclass: article
geometry: margin=1in
fontsize: 11pt
output:
  pdf_document:
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    dev: pdf
    highlight: tango
  html_document:
    theme: default
    self_contained: true
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    smart: true
    dev: svg
    
---

```{r setup, include = FALSE}
# DO NOT ALTER THIS CHUNK
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  fig.width = 5,
  fig.asp = 0.618,
  out.width = "70%",
  dpi = 120,
  fig.align = "center",
  cache = FALSE
)
# Cost function for cross validation
cost <- function(obs, pred) {
  outcome <- pred > 0.5
  return(1 - (sum(obs == outcome) / length(obs)))
}
# Load required packages
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(ggmosaic))
suppressPackageStartupMessages(library(modelr))
suppressPackageStartupMessages(library(boot))
```


```{r}
library(tidyr)
library(ggplot2)
library(ggmosaic)
library(dplyr)
library(readr)
library(class)
```


```{r}
library(tidyr)
library(ggplot2)
library(dplyr)

# 데이터 가져오기
Sleep_health_and_lifestyle_dataset <- read_csv(file = "Sleep_health_and_lifestyle_dataset.csv",
  col_types = cols(
    'Sleep Duration' = col_character(),
    'Stress Level' = col_character(),
    'Physical Activity Level' = col_character(),
    'Quality of Sleep' = col_character(),
    'BMI Category' = col_character(),
    'Blood Pressure' = col_character(),
    'Heart Rate' = col_character(),
    'Daily Steps' = col_character(),
    'Sleep Disorder' = col_character()
  ))

# 데이터 클리닝
Sleep_health_and_lifestyle_dataset_renamed <- Sleep_health_and_lifestyle_dataset %>%
  rename(ID = 'Person ID',
         Duration = 'Sleep Duration',
         Stress = 'Stress Level',
         Physical = 'Physical Activity Level',
         Quality = 'Quality of Sleep',
         BMI = 'BMI Category',
         BPressure = 'Blood Pressure',
         HRate = 'Heart Rate',
         DSteps = 'Daily Steps',
         Disorder = 'Sleep Disorder')
```

```{r}
# Sufficient Sleep T/F
sleep_data <- Sleep_health_and_lifestyle_dataset_renamed %>%
    mutate(sufficient_sleep = as.logical(Duration >= 7.0))

# 변수별 sufficient sleep 확인 - Disorder
sleep_data %>%
  pivot_longer(cols = c(Disorder), names_to = "variable", values_to = "value") %>%
  group_by(variable, value, sufficient_sleep) %>%
  summarise(count = n()) %>%
  ggplot() +
  geom_bar(
    mapping = aes(x = value, y = count, fill = sufficient_sleep),
    position = "identity",
    alpha = 0.6,
    stat = "identity"
  ) +
  facet_wrap(~ variable, scales = "free") +
  labs(x = "Value", y = "Count", fill = "Sufficient Sleep")

# 변수별 sufficient sleep 확인 - Gender
sleep_data %>%
  pivot_longer(cols = c(Gender), names_to = "variable", values_to = "value") %>%
  group_by(variable, value, sufficient_sleep) %>%
  summarise(count = n()) %>%
  ggplot() +
  geom_bar(
    mapping = aes(x = value, y = count, fill = sufficient_sleep),
    position = "identity",
    alpha = 0.6,
    stat = "identity"
  ) +
  facet_wrap(~ variable, scales = "free") +
  labs(x = "Value", y = "Count", fill = "Sufficient Sleep")

# 변수별 sufficient sleep 확인 - BMI
sleep_data %>%
  pivot_longer(cols = c(BMI), names_to = "variable", values_to = "value") %>%
  group_by(variable, value, sufficient_sleep) %>%
  summarise(count = n()) %>%
  ggplot() +
  geom_bar(
    mapping = aes(x = value, y = count, fill = sufficient_sleep),
    position = "identity",
    alpha = 0.6,
    stat = "identity"
  ) +
  facet_wrap(~ variable, scales = "free") +
  labs(x = "Value", y = "Count", fill = "Sufficient Sleep")

# 변수별 sufficient sleep 확인 - Physical, Stress, BMI, BPressure, HRate, DSteps
sleep_data %>%
  pivot_longer(cols = c(Physical, Stress, BMI, BPressure, HRate, DSteps), names_to = "variable", values_to = "value") %>%
  group_by(variable, value, sufficient_sleep) %>%
  summarise(count = n()) %>%
  ggplot() +
  geom_bar(
    mapping = aes(x = value, y = count, fill = sufficient_sleep),
    position = "identity",
    alpha = 0.6,
    stat = "identity"
  ) +
  facet_wrap(~ variable, scales = "free") +
  labs(x = "Value", y = "Count", fill = "Sufficient Sleep")
# 데이터 분할 (Training & Testing)
set.seed(123)  # For reproducibility
train_indices <- sample(1:nrow(sleep_data), 0.7 * nrow(sleep_data))  # 70% for training
trainingSet <- sleep_data[train_indices, 1:12]
testSet <- sleep_data[-train_indices, 1:12]
training_Outcomes <- sleep_data[train_indices, "sufficient_sleep"]
test_Outcomes <- sleep_data[-train_indices, "sufficient_sleep"]

# 로지스틱 회귀 모델 학습
model <- glm(sufficient_sleep ~ Age + Gender + Occupation + Physical + DSteps + BMI, data = trainingSet, family = binomial)

# 예측 수행
predictions <- predict(model, newdata = testSet, type = "response")

# 결과 분석
threshold <- 0.5  # 임계값 설정
predicted_classes <- ifelse(predictions >= threshold, "Sufficient", "Insufficient")
actual_classes <- test_Outcomes
accuracy <- sum(predicted_classes == actual_classes) / length(actual_classes)
print(paste("Accuracy:", accuracy))

# 모델 1 예측
model_1_preds <- testSet %>%
  add_predictions(model, type = "response") %>%
  mutate(
    outcome = if_else(pred > 0.5, "Sufficient", "Insufficient")
  )

```

