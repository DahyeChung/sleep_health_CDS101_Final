---
title: "Final Project"
author: "Dahye Chung"
date: "`r Sys.Date()`"
documentclass: article
geometry: margin=1in
fontsize: 11pt
output:
  pdf_document:
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    dev: pdf
    highlight: tango
  html_document:
    theme: default
    self_contained: true
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    smart: true
    dev: svg
    
---

```{r setup, include = FALSE}
# DO NOT ALTER THIS CHUNK
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  fig.width = 5,
  fig.asp = 0.618,
  out.width = "70%",
  dpi = 120,
  fig.align = "center",
  cache = FALSE
)
# Cost function for cross validation
cost <- function(obs, pred) {
  outcome <- pred > 0.5
  return(1 - (sum(obs == outcome) / length(obs)))
}
# Load required packages
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(ggmosaic))
suppressPackageStartupMessages(library(modelr))
suppressPackageStartupMessages(library(boot))
```


```{r}
library(tidyr)
ibrary(ggplot2)
library(ggmosaic)
library(dplyr)
Sleep_health_and_lifestyle_dataset <- read_csv("Sleep_health_and_lifestyle_dataset.csv")
```
#데이터 변수명 변경
```{r}
Sleep_health_and_lifestyle_dataset_renamed <- Sleep_health_and_lifestyle_dataset %>%
  rename( Duration = 'Sleep Duration',
          Stress = 'Stress Level',
          Physical = 'Physical Activity Level' ,
          Quality = 'Quality of Sleep' ,
          BMI= 'BMI Category' ,
          BPressure = 'Blood Pressure' ,
          HRate = 'Heart Rate' ,
          DSteps = 'Daily Steps' ,
          Disorder = 'Sleep Disorder' )
```


#Prediction

## Exercise 1
```{r}
train_df <- read_csv(file = "train.csv")
```                   
                     

```{r}
train_df <- read_csv(file = "train.csv",
  col_types = cols(
  Pclass = col_character(),
	SibSp = col_character(),
	Parch = col_character()
  ))
```


```{r}
train_df <- train_df %>%
mutate(did_survive = as.logical(Survived))
```

## Exercise 2

```{r}
train_df %>%
  pivot_longer(cols = Age | Fare, names_to = "variable", values_to = "value") %>%
  ggplot() +
  geom_histogram(
    mapping = aes(x = value, fill = did_survive),
    position = "identity",
    alpha = 0.6
  ) +
  facet_wrap(~ variable, scales = "free") +
  labs(x = "Value", y = "Count", fill = "Survived")  

```
A.
- The Age variable shows a wide distribution among both survivors and non-survivors in overall generation. The Fare variable shows that the majority of passengers who paid fares between 0-100 were distributed among both groups.
- With the comparison of survivors' age and fare, it is difficult to predict the pattern of survival.


## Exercise 3
```{r}
train_df %>%
  pivot_longer(cols = c(Pclass, Sex, Parch, SibSp), names_to = "Variable", values_to = "Value") %>%
  ggplot() +
  geom_bar(mapping = aes(x = Value, fill = did_survive)) +
  facet_wrap(~ Variable, scales = "free") +
  labs(x = "Value", y = "Count", fill = "Survived")  

```
A.
 - Pclass and Sex are the good predictors for survivals. 
 - Parch and SibSp are the bad predictors for survivals.
 - The graph of Sex shows female passengers have survived significantly more compare to male passengers.Additionally, all class passengers have similar survivors records but the 3rd class passages has significantly higher chance to be non-survivors. It can be predicted that women and children and higher class were prioritized. 
- Sex is the most influential predictor for survival, with females having a higher chance of survival due to the "women and children first" policy.



## Exercise 4
```{r}
library(ggmosaic)

train_df %>%
  ggplot() +
  geom_mosaic(mapping = aes(x = product(Sex, Pclass), fill = Sex)) + 
  facet_grid(. ~ did_survive, scales = "free") +
  labs(x = "Passenger class", y = "Gender", title = "Mosaic plot of Survivors of Titanic")

``` 
A.
 - In general, among survivors, females are significantly higher for all class compare to male.For non survivors, apart from the fact males have the higher change to die, third class non-survivors seems much more than the other classes. It tells the gender and pclass has affected survival prediction.
 - Generally, regardless of the pclass, the graphs show the gender plays prominent role in survival rates.


## Exercise 5
```{r}
train_df %>%
  summarize(
    total = n(),
    missing = sum(is.na(Age)),
    fraction_missing = sum(is.na(Age)) / n()
  )
```

```{r}
train_imputed <- train_df %>%
  mutate(
    age_imputed = if_else(
      condition = is.na(Age),
      true = median(Age, na.rm = TRUE),
      false = Age
    )
  )
```

```{r}
train_imputed %>%
  summarize(
    total = n(),
    missing = sum(is.na(age_imputed)),
    fraction_missing = sum(is.na(age_imputed)) / n()
  )
```

## Exercise 6
```{r}
model_1 <- glm(Survived ~ age_imputed, data = train_imputed, family = "binomial")
```

```{r}
model_1_preds <- train_imputed %>%
  add_predictions(model_1, type = "response") %>%
  mutate(
    outcome = if_else(condition = pred > 0.5,
                      true = 1,
                      false = 0)
  )
```

```{r}
model_1_preds %>%
  mutate(
    correct = if_else(
      condition = Survived == outcome,
      true = 1,
      false = 0
    )
  ) %>%
  summarize(
    total_correct = sum(correct),
    accuracy = total_correct / n()
  )
```
A.The accuracy is 0.6, which is considered moderate for a predictive model.


## Exercise 7

```{r}
logistic_cv1 <- cv.glm(train_imputed, model_1, cost, K=5)
```

```{r}
logistic_cv1$delta
```


## Exercise 8

```{r}
model_2 <- glm(Survived ~ age_imputed + SibSp + Pclass + Sex, data = train_imputed, family = "binomial")

logistic_cv2 <- cv.glm(train_imputed, model_2, cost, K = 5)
logistic_cv2$delta

```

```{r}
model_3 <- glm(Survived ~ age_imputed + SibSp + Pclass + Sex * age_imputed * Pclass, data = train_imputed, family = "binomial")

logistic_cv3 <- cv.glm(train_imputed, model_3, cost, K = 5)
logistic_cv3$delta

```

A.
model 3 has the most accurate validation error with a delta value of 0.18. The lower delta value has the better the model's performance.


## Bonus Exercise

If you choose to do the bonus exercise, write your code here. Otherwise you can delete this section.
```{r}
test_df <- read_csv(file = "test.csv")

test_imputed <- test_df %>%
  mutate(
    age_imputed = if_else(
      condition = is.na(Age),
      true = median(Age, na.rm = TRUE),
      false = Age
    )
  )

model_1_preds <- test_imputed %>%
  add_predictions(model_1, type = "response") %>%
  mutate(
    outcome = if_else(condition = pred > 0.5,
                      true = 1,
                      false = 0)
  )

model_1_preds <- model_1_preds %>%
  rename(Survived = outcome)

write_csv(select(model_1_preds, PassengerId, Survived), "predictions.csv")

```


